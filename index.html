<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>File Tree Navigator (Pure Web) ğŸŒ³</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --bg: #f5f6fb;
            --card-bg: #ffffff;
            --text: #111827;
        }
        body { font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; margin: 0; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; }
        header { background: linear-gradient(120deg, var(--primary), #0f172a); color: #fff; padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .controls { display: flex; gap: 10px; }
        main { flex: 1; display: flex; gap: 1.5rem; padding: 1.5rem; overflow: hidden; }
        .panel { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: flex; flex-direction: column; overflow: hidden; }
        .tree-panel { flex: 1; min-width: 300px; }
        .detail-panel { flex: 1.5; min-width: 350px; padding: 20px; }
        .panel-header { padding: 15px 20px; border-bottom: 1px solid #eee; font-weight: bold; background: #fafafa; }
        #treeContainer { flex: 1; overflow: auto; padding: 15px; }
        .tree, .tree ul { list-style: none; padding-left: 20px; margin: 0; }
        .tree-row { display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: 0.2s; gap: 8px; }
        .tree-row:hover { background: #f0f7ff; }
        .tree-row.selected { background: #e0efff; box-shadow: inset 0 0 0 1px #bfdbfe; }
        .tree-row.has-note::after { content: "å‚™è¨»"; font-size: 10px; background: #fef08a; color: #854d0e; padding: 2px 6px; border-radius: 10px; margin-left: auto; }
        .tree-toggle { width: 20px; cursor: pointer; text-align: center; font-family: monospace; color: var(--primary); }
        .collapsed > ul { display: none; }
        
        .detail-info { margin-bottom: 20px; font-size: 14px; }
        .detail-info div { margin-bottom: 8px; }
        .label { font-weight: bold; width: 80px; display: inline-block; color: #666; }
        textarea { width: 100%; height: 200px; border: 1px solid #ddd; border-radius: 8px; padding: 12px; font-family: inherit; resize: vertical; background: #fafafa; }
        button { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-outline { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); }
        .btn-outline:hover { background: rgba(255,255,255,0.2); }
        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <header>
        <h1>File Tree Navigator (Pure Web) ğŸŒ³</h1>
        <div class="controls">
            <label for="dirInput" class="btn-outline" style="padding: 10px 20px; border-radius: 6px; cursor: pointer;">é¸æ“‡è³‡æ–™å¤¾</label>
            <input type="file" id="dirInput" webkitdirectory directory />
            <button id="exportPdf" class="btn-outline">è¼¸å‡º PDF</button>
        </div>
    </header>

    <main>
        <div class="panel tree-panel">
            <div class="panel-header">è³‡æ–™å¤¾çµæ§‹</div>
            <div id="treeContainer">
                <p style="color:#999;text-align:center;margin-top:50px;">è«‹å…ˆé¸æ“‡ä¸€å€‹è³‡æ–™å¤¾é€²è¡Œè®€å–ã€‚</p>
                <ul id="treeRoot" class="tree"></ul>
            </div>
        </div>
        <div class="panel detail-panel" id="detailPanel" style="display:none">
            <div class="panel-header">å‚™è¨»ç·¨è¼¯</div>
            <div class="detail-info">
                <div><span class="label">åç¨±ï¼š</span><span id="nodeName"></span></div>
                <div><span class="label">è·¯å¾‘ï¼š</span><span id="nodePath" style="font-family:monospace;background:#eee;padding:2px 4px;border-radius:4px"></span></div>
            </div>
            <label style="font-weight:bold;display:block;margin-bottom:10px">å‚™è¨»å…§å®¹</label>
            <textarea id="noteInput" placeholder="åœ¨æ­¤è¼¸å…¥å‚™è¨»ï¼Œé›¢é–‹æˆ–åˆ‡æ›æ™‚æœƒè‡ªå‹•å„²å­˜..."></textarea>
            <p style="font-size:12px;color:#666;margin-top:10px">ğŸ’¡ å‚™è¨»å°‡å„²å­˜æ–¼ç€è¦½å™¨æœ¬åœ°ç©ºé–“ (LocalStorage)ã€‚</p>
        </div>
    </main>

    <script>
        const treeRoot = document.getElementById('treeRoot');
        const dirInput = document.getElementById('dirInput');
        const detailPanel = document.getElementById('detailPanel');
        const noteInput = document.getElementById('noteInput');
        
        let fileStructure = {};
        let selectedPath = null;
        let notes = JSON.parse(localStorage.getItem('pure-web-tree-notes') || '{}');

        dirInput.onchange = (e) => {
            const files = e.target.files;
            if (!files.length) return;
            buildTree(files);
            renderTree();
        };

        function buildTree(files) {
            fileStructure = { name: files[0].webkitRelativePath.split('/')[0], type: 'directory', children: [], path: '' };
            for (let i = 0; i < files.length; i++) {
                const pathParts = files[i].webkitRelativePath.split('/');
                let current = fileStructure;
                let fullPath = "";
                
                for (let j = 1; j < pathParts.length; j++) {
                    const name = pathParts[j];
                    fullPath += (fullPath ? "/" : "") + name;
                    let node = current.children.find(c => c.name === name);
                    if (!node) {
                        node = { name, type: j === pathParts.length - 1 ? 'file' : 'directory', children: [], path: fullPath };
                        current.children.push(node);
                    }
                    current = node;
                }
            }
            // Sort: folders first
            const sortNodes = (node) => {
                if (node.children) {
                    node.children.sort((a, b) => b.type.localeCompare(a.type) || a.name.localeCompare(b.name));
                    node.children.forEach(sortNodes);
                }
            };
            sortNodes(fileStructure);
        }

        function renderTree() {
            treeRoot.innerHTML = '';
            treeRoot.appendChild(createNodeEl(fileStructure));
        }

        function createNodeEl(node) {
            const li = document.createElement('li');
            const row = document.createElement('div');
            row.className = 'tree-row';
            if (notes[node.path]) row.classList.add('has-note');
            
            const toggle = document.createElement('span');
            toggle.className = 'tree-toggle';
            toggle.innerText = node.type === 'directory' ? 'â–¼' : '';
            if (node.type === 'directory') {
                toggle.onclick = (e) => {
                    e.stopPropagation();
                    li.classList.toggle('collapsed');
                    toggle.innerText = li.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
                };
            }
            row.appendChild(toggle);

            const label = document.createElement('span');
            label.innerText = (node.type === 'directory' ? 'ğŸ“ ' : 'ğŸ“„ ') + node.name;
            row.appendChild(label);

            row.onclick = () => {
                document.querySelectorAll('.tree-row').forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
                showDetail(node);
            };

            li.appendChild(row);
            if (node.children && node.children.length) {
                const ul = document.createElement('ul');
                node.children.forEach(c => ul.appendChild(createNodeEl(c)));
                li.appendChild(ul);
            }
            return li;
        }

        function showDetail(node) {
            saveCurrentNote();
            selectedPath = node.path;
            detailPanel.style.display = 'block';
            document.getElementById('nodeName').innerText = node.name;
            document.getElementById('nodePath').innerText = node.path || '(æ ¹ç›®éŒ„)';
            noteInput.value = notes[node.path] || '';
        }

        function saveCurrentNote() {
            if (selectedPath !== null) {
                const val = noteInput.value.trim();
                if (val) {
                    notes[selectedPath] = val;
                } else {
                    delete notes[selectedPath];
                }
                localStorage.setItem('pure-web-tree-notes', JSON.stringify(notes));
                updateIndicators();
            }
        }

        noteInput.onblur = saveCurrentNote;

        function updateIndicators() {
            document.querySelectorAll('.tree-row').forEach(row => {
                const text = row.innerText.replace(/[ğŸ“ğŸ“„â–¼â–¶]\s/, '').trim();
                // This is a simplified check for demo
                const isSelected = row.classList.contains('selected');
                if (isSelected && notes[selectedPath]) row.classList.add('has-note');
                else if (isSelected) row.classList.remove('has-note');
            });
        }

        document.getElementById('exportPdf').onclick = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(18);
            doc.text("File Tree Report", 20, 20);
            doc.setFontSize(12);
            let y = 30;
            
            const printNode = (node, depth) => {
                if (y > 280) { doc.addPage(); y = 20; }
                const indent = "  ".repeat(depth);
                const note = notes[node.path] ? ` [å‚™è¨»: ${notes[node.path]}]` : "";
                doc.text(`${indent}${node.type === 'directory' ? '+' : '-'} ${node.name}${note}`, 20, y);
                y += 7;
                if (node.children) node.children.forEach(c => printNode(c, depth + 1));
            };
            
            printNode(fileStructure, 0);
            doc.save("file-tree-report.pdf");
        };
    </script>
</body>
</html>
